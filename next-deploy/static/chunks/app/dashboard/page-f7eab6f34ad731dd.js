(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{3683:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>w});var t=r(5155),a=r(2115),i=r(5647);let l=()=>(0,i.UU)("https://dxwolbmhjqsgznwamuab.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR4d29sYm1oanFzZ3pud2FtdWFiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg3MTczNjksImV4cCI6MjA2NDI5MzM2OX0.MfiDkJsm98UG4HBoaQgvQKEMrdNk67Ral1TUxaVh7SU");var n=r(6874),d=r.n(n);function c(e){var s,r;let{user:i,userProfile:l}=e,[n,c]=(0,a.useState)(!1),o=async()=>{window.location.href="/login"};return(0,t.jsx)("header",{className:"sticky top-0 z-50 bg-white/90 backdrop-blur-md border-b border-gray-200",children:(0,t.jsx)("div",{className:"max-w-7xl mx-auto px-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,t.jsx)(d(),{href:"/",className:"flex items-center space-x-3",children:(0,t.jsx)("div",{className:"text-2xl font-bold text-slate-900",children:"Packshot.art"})}),(0,t.jsxs)("nav",{className:"hidden md:flex items-center space-x-8",children:[(0,t.jsx)(d(),{href:"/catalogue",className:"text-gray-600 hover:text-indigo-600 font-medium transition-colors",children:"Catalogue"}),(0,t.jsx)(d(),{href:"/dashboard",className:"text-indigo-600 font-medium",children:"Dashboard"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("div",{className:"hidden sm:flex items-center space-x-2 bg-indigo-50 px-3 py-2 rounded-lg",children:(0,t.jsxs)("span",{className:"text-sm font-medium text-indigo-600",children:[l.credits.toLocaleString()," cr\xe9dits"]})}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)("button",{onClick:()=>c(!n),className:"flex items-center space-x-2 bg-gray-100 hover:bg-gray-200 px-3 py-2 rounded-lg transition-colors",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-indigo-600 rounded-full flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-white text-sm font-medium",children:null==(s=i.email)?void 0:s.charAt(0).toUpperCase()})}),(0,t.jsx)("span",{className:"hidden md:block text-sm font-medium text-gray-700",children:null==(r=i.email)?void 0:r.split("@")[0]}),(0,t.jsx)("svg",{className:"w-4 h-4 text-gray-400 transition-transform ".concat(n?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),n&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"fixed inset-0 z-10",onClick:()=>c(!1)}),(0,t.jsxs)("div",{className:"absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-20",children:[(0,t.jsxs)("div",{className:"px-4 py-3 border-b border-gray-100",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-900",children:i.email}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:[l.credits.toLocaleString()," cr\xe9dits disponibles"]})]}),(0,t.jsx)(d(),{href:"/profile",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:()=>c(!1),children:"Mon Profil"}),(0,t.jsx)(d(),{href:"/acheter-credits",className:"block px-4 py-2 text-sm text-gray-700 hover:bg-gray-50",onClick:()=>c(!1),children:"Acheter des Cr\xe9dits"}),(0,t.jsx)("button",{onClick:o,className:"w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50",children:"D\xe9connexion"})]})]})]})]})]})})})}function o(e){let{stats:s}=e,r=[{icon:"\uD83D\uDCB3",value:s.credits.toLocaleString(),label:"Cr\xe9dits Disponibles",color:"from-indigo-500 to-purple-600"},{icon:"\uD83D\uDCE6",value:s.activeOrders,label:"Commandes Actives",color:"from-blue-500 to-cyan-600"},{icon:"\uD83C\uDFA8",value:s.availableDAs.toLocaleString(),label:"DA Disponibles",color:"from-green-500 to-emerald-600"},{icon:"\uD83D\uDD12",value:s.activeReservations,label:"R\xe9servations Actives",color:"from-orange-500 to-red-600"}];return(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:r.map((e,s)=>(0,t.jsx)("div",{className:"\n            bg-gradient-to-br ".concat(e.color," \n            text-white rounded-xl p-6 \n            transform hover:scale-105 transition-all duration-300\n            shadow-lg hover:shadow-xl\n            animate-in slide-in-from-bottom-4\n          "),style:{animationDelay:"".concat(100*s,"ms")},children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-3xl font-bold mb-1",children:e.value}),(0,t.jsx)("div",{className:"text-white/90 font-medium",children:e.label})]}),(0,t.jsx)("div",{className:"text-4xl opacity-80",children:e.icon})]})},s))})}function m(e){let{tabs:s,activeTab:r,onTabChange:a}=e;return(0,t.jsx)("div",{className:"border-b border-gray-200 mb-8",children:(0,t.jsx)("nav",{className:"-mb-px flex space-x-8 overflow-x-auto",children:s.map(e=>(0,t.jsx)("button",{onClick:()=>a(e.id),className:"\n              whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm\n              transition-colors duration-200\n              ".concat(r===e.id?"border-indigo-500 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300","\n            "),children:(0,t.jsxs)("span",{className:"flex items-center space-x-2",children:[(0,t.jsx)("span",{children:e.icon}),(0,t.jsx)("span",{className:"hidden sm:inline",children:e.label.replace(/^[^\s]+ /,"")}),(0,t.jsx)("span",{className:"sm:hidden",children:e.icon})]})},e.id))})})}function x(e){let{user:s,userProfile:r,supabase:i,stats:l,onRefresh:n}=e,[c,o]=(0,a.useState)([]),[m,x]=(0,a.useState)([]),[u,h]=(0,a.useState)(!1);(0,a.useEffect)(()=>{g()},[s]);let g=async()=>{h(!0);try{await Promise.all([p(),b()])}catch(e){console.error("Erreur chargement donn\xe9es vue d'ensemble:",e)}finally{h(!1)}},p=async()=>{try{let{data:e,error:r}=await i.from("orders").select("id, status, created_at, total_amount, items_count").eq("user_id",s.id).order("created_at",{ascending:!1}).limit(5);if(r)throw r;o(e||[])}catch(e){console.error("Erreur chargement commandes:",e),o([])}},b=async()=>{try{let{data:e,error:r}=await i.from("reservations").select("\n          id,\n          expires_at,\n          status,\n          design_aesthetics (name)\n        ").eq("user_id",s.id).eq("status","active").order("expires_at",{ascending:!0});if(r)throw r;let t=(null==e?void 0:e.map(e=>{var s;return{id:e.id,da_name:(null==(s=e.design_aesthetics)?void 0:s.name)||"DA inconnue",expires_at:e.expires_at,status:e.status}}))||[];x(t)}catch(e){console.error("Erreur chargement r\xe9servations:",e),x([])}},v=e=>{switch(e){case"completed":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"processing":return"bg-blue-100 text-blue-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},f=e=>{switch(e){case"completed":return"Termin\xe9e";case"pending":return"En attente";case"processing":return"En cours";case"cancelled":return"Annul\xe9e";default:return e}},y=e=>new Date(e).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}),j=e=>{let s=new Date,r=new Date(e).getTime()-s.getTime();if(r<=0)return"Expir\xe9e";let t=Math.floor(r/36e5),a=Math.floor(r%36e5/6e4);return t>0?"".concat(t,"h ").concat(a,"min restantes"):"".concat(a,"min restantes")};return(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"⚡ Actions Rapides"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:[(0,t.jsxs)(d(),{href:"/catalogue",className:"block p-6 bg-white border border-gray-200 rounded-lg hover:shadow-md transition-shadow",children:[(0,t.jsx)("div",{className:"text-3xl mb-3",children:"\uD83C\uDFA8"}),(0,t.jsx)("div",{className:"font-semibold text-gray-900 mb-2",children:"Parcourir le Catalogue"}),(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"D\xe9couvrir les directions artistiques"})]}),(0,t.jsxs)(d(),{href:"/acheter-credits",className:"block p-6 bg-white border border-gray-200 rounded-lg hover:shadow-md transition-shadow",children:[(0,t.jsx)("div",{className:"text-3xl mb-3",children:"\uD83D\uDCB3"}),(0,t.jsx)("div",{className:"font-semibold text-gray-900 mb-2",children:"Acheter des Cr\xe9dits"}),(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Recharger votre solde"})]}),(0,t.jsxs)("button",{onClick:n,className:"block w-full p-6 bg-white border border-gray-200 rounded-lg hover:shadow-md transition-shadow text-left",children:[(0,t.jsx)("div",{className:"text-3xl mb-3",children:"\uD83D\uDD04"}),(0,t.jsx)("div",{className:"font-semibold text-gray-900 mb-2",children:"Actualiser"}),(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Rafra\xeechir les donn\xe9es"})]})]})]}),(0,t.jsxs)("div",{className:"grid lg:grid-cols-2 gap-8",children:[(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm",children:[(0,t.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"\uD83D\uDD12 R\xe9servations Actives"}),(0,t.jsx)("button",{onClick:b,className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium",children:"Actualiser →"})]})}),(0,t.jsx)("div",{className:"p-6",children:u?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-indigo-600 mx-auto mb-2"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Chargement..."})]}):0===m.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"text-3xl mb-3 opacity-50",children:"\uD83D\uDD12"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Aucune r\xe9servation active"})]}):(0,t.jsx)("div",{className:"space-y-4",children:m.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-medium text-gray-900",children:e.da_name}),(0,t.jsx)("div",{className:"text-sm text-gray-600",children:j(e.expires_at)})]}),(0,t.jsx)("div",{className:"text-xl",children:"⏱️"})]},e.id))})})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm",children:[(0,t.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"\uD83D\uDCE6 Mes Commandes"}),(0,t.jsx)("button",{onClick:p,className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium",children:"Actualiser →"})]})}),(0,t.jsx)("div",{className:"p-6",children:u?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-indigo-600 mx-auto mb-2"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Chargement..."})]}):0===c.length?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"text-3xl mb-3 opacity-50",children:"\uD83D\uDCE6"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Aucune commande"}),(0,t.jsx)(d(),{href:"/catalogue",className:"inline-block mt-3 text-indigo-600 hover:text-indigo-700 font-medium",children:"Passer votre premi\xe8re commande →"})]}):(0,t.jsx)("div",{className:"space-y-4",children:c.map(e=>{var s;return(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,t.jsxs)("span",{className:"font-medium text-gray-900",children:["Commande #",e.id.slice(-6)]}),(0,t.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-medium ".concat(v(e.status)),children:f(e.status)})]}),(0,t.jsxs)("div",{className:"text-sm text-gray-600",children:[e.items_count," article",e.items_count>1?"s":""," • ",y(e.created_at)]})]}),(0,t.jsx)("div",{className:"text-right",children:(0,t.jsxs)("div",{className:"font-semibold text-gray-900",children:[null==(s=e.total_amount)?void 0:s.toLocaleString()," cr\xe9dits"]})})]},e.id)})})})]})]})]})}function u(e){let{user:s,userProfile:r,supabase:i}=e,[l,n]=(0,a.useState)(""),[d,c]=(0,a.useState)(!1),[o,m]=(0,a.useState)(null),x=async e=>{if(e.preventDefault(),!l.trim())return void m({type:"error",text:"Veuillez saisir votre message"});c(!0),m(null);try{let{error:e}=await i.from("user_feedback").insert({user_id:s.id,message:l.trim(),user_email:s.email});if(e)throw e;m({type:"success",text:"Merci pour votre feedback ! Nous l'avons bien re\xe7u."}),n("")}catch(e){console.error("Erreur envoi feedback:",e),m({type:"error",text:"Erreur lors de l'envoi. Veuillez r\xe9essayer."})}finally{c(!1)}};return(0,t.jsx)("div",{className:"max-w-3xl",children:(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-8",children:[(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"\uD83D\uDC8C Suggestions & Feedback"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Partagez vos id\xe9es pour am\xe9liorer Packshot.art"})]}),o&&(0,t.jsx)("div",{className:"\n            mb-6 p-4 rounded-lg border\n            ".concat("success"===o.type?"bg-green-50 border-green-200 text-green-800":"","\n            ").concat("error"===o.type?"bg-red-50 border-red-200 text-red-800":"","\n            ").concat("info"===o.type?"bg-blue-50 border-blue-200 text-blue-800":"","\n          "),children:o.text}),(0,t.jsxs)("form",{onSubmit:x,className:"space-y-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"feedback-message",className:"block font-semibold mb-2 text-gray-900",children:"Votre message"}),(0,t.jsx)("textarea",{id:"feedback-message",value:l,onChange:e=>n(e.target.value),rows:6,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 resize-vertical",placeholder:"D\xe9crivez votre suggestion, probl\xe8me rencontr\xe9, ou toute id\xe9e d'am\xe9lioration...",required:!0})]}),(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("button",{type:"submit",disabled:d||!l.trim(),className:"bg-indigo-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:d?"⏳ Envoi...":"✉️ Envoyer Feedback"}),(0,t.jsxs)("div",{className:"text-sm text-gray-500",children:[l.length,"/2000 caract\xe8res"]})]})]}),(0,t.jsxs)("div",{className:"mt-8 p-6 bg-indigo-50 rounded-lg border-l-4 border-indigo-500",children:[(0,t.jsx)("h3",{className:"font-semibold text-indigo-900 mb-2",children:"\uD83D\uDCA1 Id\xe9es bienvenues"}),(0,t.jsx)("p",{className:"text-indigo-700 text-sm",children:"Nouvelles fonctionnalit\xe9s, am\xe9liorations UX, suggestions de DA, probl\xe8mes techniques... Tous vos retours nous aident \xe0 am\xe9liorer l'exp\xe9rience !"})]})]})})}function h(e){let{user:s,userProfile:r,supabase:i,onRefresh:l}=e,[n,d]=(0,a.useState)(""),[c,o]=(0,a.useState)({totalReferrals:0,creditsEarned:0,pendingReferrals:0}),[m,x]=(0,a.useState)(""),[u,h]=(0,a.useState)(!1),[g,p]=(0,a.useState)(null);(0,a.useEffect)(()=>{b()},[r]);let b=async()=>{try{d(r.referral_code||""),await v()}catch(e){console.error("Erreur chargement donn\xe9es parrainage:",e)}},v=async()=>{try{let{data:e,error:r}=await i.from("referral_tracking").select("*").eq("referrer_id",s.id);if(r)throw r;let t=(null==e?void 0:e.filter(e=>"completed"===e.status))||[],a=(null==e?void 0:e.filter(e=>"pending"===e.status))||[];o({totalReferrals:t.length,creditsEarned:1e3*t.length,pendingReferrals:a.length})}catch(e){console.error("Erreur chargement statistiques parrainage:",e),o({totalReferrals:0,creditsEarned:0,pendingReferrals:0})}},f=async()=>{try{await navigator.clipboard.writeText(n),p({type:"success",text:"Code copi\xe9 dans le presse-papier !"}),setTimeout(()=>p(null),3e3)}catch(e){p({type:"error",text:"Erreur lors de la copie"}),setTimeout(()=>p(null),3e3)}},y=async()=>{let e="https://packshot.art/register?ref=".concat(n);if(navigator.share)try{await navigator.share({title:"Rejoignez Packshot.art",text:"Utilisez mon code de parrainage ".concat(n," et gagnez 1000 cr\xe9dits !"),url:e})}catch(s){await j(e)}else await j(e)},j=async e=>{try{await navigator.clipboard.writeText(e),p({type:"success",text:"Lien de parrainage copi\xe9 !"}),setTimeout(()=>p(null),3e3)}catch(e){p({type:"error",text:"Erreur lors de la copie du lien"}),setTimeout(()=>p(null),3e3)}},N=async e=>{if(e.preventDefault(),!m.trim())return void p({type:"error",text:"Veuillez saisir un code de parrainage"});h(!0),p(null);try{let{data:e,error:r}=await i.rpc("apply_referral_code",{user_id:s.id,referral_code:m.toUpperCase()});if(r)throw r;(null==e?void 0:e.success)?(p({type:"success",text:"Code de parrainage valid\xe9 ! Vous recevrez 1000 cr\xe9dits lors de votre premier achat."}),x(""),l()):p({type:"error",text:(null==e?void 0:e.message)||"Code de parrainage invalide"})}catch(e){console.error("Erreur validation code parrainage:",e),p({type:"error",text:e.message||"Erreur lors de la validation du code"})}finally{h(!1)}};return(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"\uD83D\uDC65 Syst\xe8me de Parrainage"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Parrainez vos amis et gagnez 1000 cr\xe9dits chacun"})]}),g&&(0,t.jsx)("div",{className:"\n          p-4 rounded-lg border\n          ".concat("success"===g.type?"bg-green-50 border-green-200 text-green-800":"","\n          ").concat("error"===g.type?"bg-red-50 border-red-200 text-red-800":"","\n          ").concat("info"===g.type?"bg-blue-50 border-blue-200 text-blue-800":"","\n        "),children:g.text}),(0,t.jsxs)("div",{className:"bg-gradient-to-br from-indigo-500 to-teal-600 text-white p-8 rounded-xl",children:[(0,t.jsx)("h3",{className:"text-xl font-semibold mb-6",children:"\uD83C\uDFAF Votre Code de Parrainage"}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4",children:[(0,t.jsxs)("div",{className:"bg-white/20 backdrop-blur-sm px-6 py-4 rounded-lg",children:[(0,t.jsx)("div",{className:"text-sm opacity-90 mb-1",children:"Votre code :"}),(0,t.jsx)("div",{className:"text-2xl font-bold tracking-wider",children:n||"Chargement..."})]}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)("button",{onClick:f,disabled:!n,className:"bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",children:"\uD83D\uDCCB Copier"}),(0,t.jsx)("button",{onClick:y,disabled:!n,className:"bg-white/20 hover:bg-white/30 px-4 py-2 rounded-lg font-medium transition-colors disabled:opacity-50",children:"\uD83D\uDD17 Partager"})]})]})]}),(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-8",children:[(0,t.jsxs)("div",{className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm",children:[(0,t.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:"\uD83D\uDCE5 J'ai un Code de Parrainage"}),(0,t.jsx)("p",{className:"text-gray-600 mb-6",children:"Saisissez le code de votre parrain pour gagner 1000 cr\xe9dits lors de votre premier achat"}),(0,t.jsxs)("form",{onSubmit:N,className:"space-y-4",children:[(0,t.jsx)("div",{children:(0,t.jsx)("input",{type:"text",value:m,onChange:e=>x(e.target.value.toUpperCase()),placeholder:"Ex: AB1234",maxLength:6,pattern:"[A-Z]{2}[0-9]{4}",className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-center text-lg font-semibold tracking-wider uppercase focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})}),(0,t.jsx)("button",{type:"submit",disabled:u||!m.trim(),className:"w-full bg-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:u?"⏳ Validation...":"✅ Valider le Code"})]})]}),(0,t.jsxs)("div",{className:"bg-white p-6 rounded-xl border border-gray-200 shadow-sm",children:[(0,t.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-6",children:"\uD83D\uDCCA Mes Statistiques"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center py-3 border-b border-gray-100",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Parrainages r\xe9ussis"}),(0,t.jsx)("span",{className:"font-semibold text-gray-900",children:c.totalReferrals})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center py-3 border-b border-gray-100",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Cr\xe9dits gagn\xe9s"}),(0,t.jsx)("span",{className:"font-semibold text-green-600",children:c.creditsEarned.toLocaleString()})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center py-3",children:[(0,t.jsx)("span",{className:"text-gray-600",children:"En attente"}),(0,t.jsx)("span",{className:"font-semibold text-orange-600",children:c.pendingReferrals})]})]})]})]}),(0,t.jsxs)("div",{className:"bg-gray-50 p-6 rounded-xl border-l-4 border-indigo-500",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"\uD83D\uDCA1 Comment \xe7a marche ?"}),(0,t.jsx)("div",{className:"grid sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[{step:"1️⃣",title:"Partagez votre code",desc:"Donnez votre code unique \xe0 vos amis"},{step:"2️⃣",title:"Ils s'inscrivent",desc:"Avec votre code lors de l'inscription"},{step:"3️⃣",title:"Premier achat",desc:"D\xe8s leur premier achat de cr\xe9dits ou abonnement"},{step:"\uD83C\uDF89",title:"1000 cr\xe9dits chacun",desc:"Automatiquement ajout\xe9s \xe0 vos comptes"}].map((e,s)=>(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"font-semibold text-indigo-600 mb-2",children:[e.step," ",e.title]}),(0,t.jsx)("div",{className:"text-sm text-gray-600",children:e.desc})]},s))})]})]})}function g(e){let{user:s,userProfile:r,supabase:i,onRefresh:l}=e,[n,d]=(0,a.useState)(""),[c,o]=(0,a.useState)(!1),[m,x]=(0,a.useState)(null),[u,h]=(0,a.useState)([]),[g,p]=(0,a.useState)(!0);(0,a.useEffect)(()=>{b()},[s]);let b=async()=>{try{p(!0);let{data:e,error:r}=await i.from("promo_code_usage").select("\n          id,\n          code,\n          used_at,\n          promo_codes (\n            discount_type,\n            discount_value,\n            description\n          )\n        ").eq("user_id",s.id).order("used_at",{ascending:!1});if(r)throw r;let t=(null==e?void 0:e.map(e=>{var s,r,t;return{id:e.id,code:e.code,discount_type:(null==(s=e.promo_codes)?void 0:s.discount_type)||"percentage",discount_value:(null==(r=e.promo_codes)?void 0:r.discount_value)||0,used_at:e.used_at,description:null==(t=e.promo_codes)?void 0:t.description}}))||[];h(t)}catch(e){console.error("Erreur chargement historique codes promo:",e),h([])}finally{p(!1)}},v=async e=>{if(e.preventDefault(),!n.trim())return void x({type:"error",text:"Veuillez saisir un code promo"});o(!0),x(null);try{let{data:e,error:r}=await i.rpc("apply_promo_code",{user_id:s.id,promo_code:n.toUpperCase()});if(r)throw r;if(null==e?void 0:e.success){let s="percentage"===e.discount_type?"".concat(e.discount_value,"%"):"".concat(e.discount_value," cr\xe9dits");x({type:"success",text:"Code promo appliqu\xe9 avec succ\xe8s ! R\xe9duction de ".concat(s,".")}),d(""),await b(),l()}else x({type:"error",text:(null==e?void 0:e.message)||"Code promo invalide ou expir\xe9"})}catch(e){var r,t,a;console.error("Erreur application code promo:",e),(null==(r=e.message)?void 0:r.includes("already_used"))?x({type:"error",text:"Ce code promo a d\xe9j\xe0 \xe9t\xe9 utilis\xe9"}):(null==(t=e.message)?void 0:t.includes("expired"))?x({type:"error",text:"Ce code promo a expir\xe9"}):(null==(a=e.message)?void 0:a.includes("not_found"))?x({type:"error",text:"Code promo invalide"}):x({type:"error",text:"Erreur lors de l'application du code promo"})}finally{o(!1)}},f=e=>new Date(e).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),y=(e,s)=>"percentage"===e?"".concat(s,"%"):"".concat(s," cr\xe9dits");return(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"\uD83C\uDF81 Codes Promo"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Utilisez vos codes promo pour b\xe9n\xe9ficier de r\xe9ductions"})]}),m&&(0,t.jsx)("div",{className:"\n          p-4 rounded-lg border\n          ".concat("success"===m.type?"bg-green-50 border-green-200 text-green-800":"","\n          ").concat("error"===m.type?"bg-red-50 border-red-200 text-red-800":"","\n          ").concat("info"===m.type?"bg-blue-50 border-blue-200 text-blue-800":"","\n        "),children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("span",{className:"mr-2",children:"success"===m.type?"✅":"error"===m.type?"❌":"ℹ️"}),m.text]})}),(0,t.jsxs)("div",{className:"bg-gradient-to-br from-purple-50 to-indigo-50 p-8 rounded-xl border border-purple-200",children:[(0,t.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-4",children:"✨ Utiliser un Code Promo"}),(0,t.jsxs)("form",{onSubmit:v,className:"flex flex-col sm:flex-row gap-4",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Code Promo"}),(0,t.jsx)("input",{type:"text",value:n,onChange:e=>d(e.target.value.toUpperCase()),placeholder:"Entrez votre code promo",className:"w-full px-4 py-3 border border-gray-300 rounded-lg text-lg font-semibold tracking-wider uppercase focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"})]}),(0,t.jsx)("div",{className:"sm:pt-7",children:(0,t.jsx)("button",{type:"submit",disabled:c||!n.trim(),className:"w-full sm:w-auto bg-indigo-600 text-white py-3 px-8 rounded-lg font-semibold hover:bg-indigo-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:c?"⏳ Validation...":"Valider"})})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm",children:[(0,t.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,t.jsx)("h3",{className:"text-xl font-semibold text-gray-900",children:"\uD83D\uDCCA Mes Codes Utilis\xe9s"})}),(0,t.jsx)("div",{className:"p-6",children:g?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-3"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Chargement de l'historique..."})]}):0===u.length?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("div",{className:"text-4xl mb-4 opacity-50",children:"\uD83C\uDF81"}),(0,t.jsx)("h4",{className:"text-lg font-medium text-gray-900 mb-2",children:"Aucun code promo utilis\xe9"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Utilisez votre premier code promo ci-dessus pour commencer \xe0 \xe9conomiser !"})]}):(0,t.jsx)("div",{className:"space-y-4",children:u.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-3 mb-1",children:[(0,t.jsx)("span",{className:"font-semibold text-gray-900 tracking-wider",children:e.code}),(0,t.jsxs)("span",{className:"\n                        px-2 py-1 rounded-full text-xs font-medium\n                        ".concat("percentage"===e.discount_type?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800","\n                      "),children:["-",y(e.discount_type,e.discount_value)]})]}),e.description&&(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-1",children:e.description}),(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:["Utilis\xe9 le ",f(e.used_at)]})]}),(0,t.jsx)("div",{className:"text-2xl opacity-60",children:"✅"})]},e.id))})})]}),(0,t.jsxs)("div",{className:"bg-amber-50 p-6 rounded-xl border-l-4 border-amber-400",children:[(0,t.jsx)("h4",{className:"font-semibold text-amber-800 mb-2",children:"\uD83D\uDCA1 Conseils"}),(0,t.jsxs)("ul",{className:"text-sm text-amber-700 space-y-1",children:[(0,t.jsx)("li",{children:"• Les codes promo sont \xe0 usage unique"}),(0,t.jsx)("li",{children:"• V\xe9rifiez la date d'expiration avant utilisation"}),(0,t.jsx)("li",{children:"• Certains codes peuvent avoir des conditions sp\xe9cifiques"}),(0,t.jsx)("li",{children:"• Suivez nos r\xe9seaux sociaux pour des codes exclusifs"})]})]})]})}var p=r(6766);function b(e){let{user:s,userProfile:r,supabase:i}=e,[l,n]=(0,a.useState)([]),[c,o]=(0,a.useState)(!0);(0,a.useEffect)(()=>{m()},[s]);let m=async()=>{try{o(!0);let{data:e,error:r}=await i.from("order_items").select("\n          id,\n          da_id,\n          created_at,\n          orders!inner (\n            user_id,\n            status\n          ),\n          design_aesthetics (\n            name,\n            image_url,\n            price_credits,\n            page_slug\n          )\n        ").eq("orders.user_id",s.id).eq("orders.status","completed").order("created_at",{ascending:!1});if(r)throw r;let t=(null==e?void 0:e.map(e=>{var s,r,t,a;return{id:e.id,da_id:e.da_id,da_name:(null==(s=e.design_aesthetics)?void 0:s.name)||"DA inconnue",da_image_url:(null==(r=e.design_aesthetics)?void 0:r.image_url)||"",da_price:(null==(t=e.design_aesthetics)?void 0:t.price_credits)||0,purchased_at:e.created_at,page_slug:null==(a=e.design_aesthetics)?void 0:a.page_slug}}))||[];n(t)}catch(e){console.error("Erreur chargement biblioth\xe8que:",e),n([])}finally{o(!1)}},x=e=>new Date(e).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}),u=e=>Math.round(.7*e);return c?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Chargement de votre biblioth\xe8que..."})]}):(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"\uD83D\uDCDA Vos DAs Achet\xe9es"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Consultez vos directions artistiques achet\xe9es et re-commandez avec -30%"})]}),0===l.length?(0,t.jsxs)("div",{className:"text-center py-16 bg-gray-50 rounded-xl",children:[(0,t.jsx)("div",{className:"text-6xl mb-6 opacity-50",children:"\uD83D\uDCDA"}),(0,t.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-3",children:"Aucune DA achet\xe9e"}),(0,t.jsx)("p",{className:"text-gray-600 mb-6",children:"D\xe9couvrez notre catalogue pour commander vos premi\xe8res directions artistiques"}),(0,t.jsx)(d(),{href:"/catalogue",className:"inline-block bg-indigo-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-indigo-700 transition-colors",children:"\uD83C\uDFA8 Voir le Catalogue"})]}):(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(e=>(0,t.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden hover:shadow-md transition-shadow",children:[(0,t.jsxs)("div",{className:"aspect-square relative bg-gray-100",children:[e.da_image_url?(0,t.jsx)(p.default,{src:e.da_image_url,alt:e.da_name,fill:!0,className:"object-cover",sizes:"(max-width: 768px) 100vw, (max-width: 1200px) 50vw, 33vw"}):(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center text-gray-400",children:(0,t.jsx)("span",{className:"text-4xl",children:"\uD83C\uDFA8"})}),(0,t.jsx)("div",{className:"absolute top-3 right-3 bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium",children:"Achet\xe9"})]}),(0,t.jsxs)("div",{className:"p-4",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900 mb-2 line-clamp-2",children:e.da_name}),(0,t.jsxs)("div",{className:"text-sm text-gray-600 mb-4",children:["Achet\xe9 le ",x(e.purchased_at)]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsxs)("div",{className:"text-gray-500 line-through",children:[e.da_price.toLocaleString()," cr\xe9dits"]}),(0,t.jsxs)("div",{className:"font-semibold text-green-600",children:[u(e.da_price).toLocaleString()," cr\xe9dits (-30%)"]})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[e.page_slug&&(0,t.jsx)(d(),{href:"/da/".concat(e.page_slug),className:"text-indigo-600 hover:text-indigo-700 text-sm font-medium",children:"Voir"}),(0,t.jsx)("button",{onClick:()=>{console.log("Re-commander DA:",e.da_id)},className:"bg-indigo-600 text-white px-3 py-1 rounded text-sm font-medium hover:bg-indigo-700 transition-colors",children:"Re-commander"})]})]})]})]},e.id))})]})}function v(){return(0,t.jsx)("div",{className:"max-w-4xl",children:(0,t.jsx)("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-8",children:(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("div",{className:"text-6xl mb-6 opacity-50",children:"\uD83D\uDCCA"}),(0,t.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-3",children:"Abonnements"}),(0,t.jsx)("p",{className:"text-gray-600 mb-6",children:"La gestion des abonnements sera disponible prochainement."}),(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"En d\xe9veloppement - Version Next.js Dashboard"})]})})})}function f(){return(0,t.jsx)("div",{className:"max-w-4xl",children:(0,t.jsx)("div",{className:"bg-white rounded-xl border border-gray-200 shadow-sm p-8",children:(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("div",{className:"text-6xl mb-6 opacity-50",children:"\uD83D\uDCC4"}),(0,t.jsx)("h3",{className:"text-xl font-semibold text-gray-900 mb-3",children:"Factures"}),(0,t.jsx)("p",{className:"text-gray-600 mb-6",children:"L'historique des factures sera disponible prochainement."}),(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"En d\xe9veloppement - Version Next.js Dashboard"})]})})})}function y(){return(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-indigo-600 mx-auto mb-4"}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-gray-700 mb-2",children:"Chargement du Dashboard"}),(0,t.jsx)("p",{className:"text-gray-500",children:"R\xe9cup\xe9ration de vos donn\xe9es..."})]})})}var j=r(5695);let N=[{id:"overview",label:"\uD83D\uDCCA Vue d'ensemble",icon:"\uD83D\uDCCA"},{id:"feedback",label:"\uD83D\uDC8C Feedback",icon:"\uD83D\uDC8C"},{id:"referral",label:"\uD83D\uDC65 Parrainage",icon:"\uD83D\uDC65"},{id:"promos",label:"\uD83C\uDF81 Codes Promo",icon:"\uD83C\uDF81"},{id:"library",label:"\uD83D\uDCDA Biblioth\xe8que DAs",icon:"\uD83D\uDCDA"},{id:"subscriptions",label:"\uD83D\uDCCA Abonnements",icon:"\uD83D\uDCCA"},{id:"invoices",label:"\uD83D\uDCC4 Factures",icon:"\uD83D\uDCC4"}];function w(){let[e,s]=(0,a.useState)(null),[r,i]=(0,a.useState)(null),[n,d]=(0,a.useState)({credits:0,activeOrders:0,activeReservations:0,availableDAs:0}),[p,w]=(0,a.useState)("overview"),[D,_]=(0,a.useState)(!0),[C,k]=(0,a.useState)(null),A=(0,j.useRouter)(),E=l();(0,a.useEffect)(()=>{S()},[]);let S=async()=>{try{_(!0);let{data:{user:e},error:r}=await E.auth.getUser();if(r||!e)return void A.push("/login?redirect=dashboard");s(e),await q(e.id),await R(e.id)}catch(e){console.error("Erreur initialisation dashboard:",e),k("Erreur lors du chargement du dashboard")}finally{_(!1)}},q=async s=>{try{let{data:r,error:t}=await E.from("profiles").select("id, email, credits, referral_code").eq("id",s).single();if(t){console.error("Erreur profil:",t);let{data:r,error:a}=await E.from("profiles").insert({id:s,email:(null==e?void 0:e.email)||"",credits:0,referral_code:z()}).select().single();if(a)throw a;i(r)}else i(r)}catch(e){console.error("Erreur chargement profil:",e)}},z=()=>{let e="ABCDEFGHIJKLMNOPQRSTUVWXYZ",s="0123456789";return e.charAt(Math.floor(Math.random()*e.length))+e.charAt(Math.floor(Math.random()*e.length))+s.charAt(Math.floor(Math.random()*s.length))+s.charAt(Math.floor(Math.random()*s.length))+s.charAt(Math.floor(Math.random()*s.length))+s.charAt(Math.floor(Math.random()*s.length))},R=async e=>{try{var s,r,t,a;let[i,l,n,c]=await Promise.all([E.from("profiles").select("credits").eq("id",e).single(),E.from("orders").select("id").eq("user_id",e).eq("status","pending"),E.from("reservations").select("id").eq("user_id",e).eq("status","active"),E.from("design_aesthetics").select("id").eq("active",!0)]);d({credits:(null==(s=i.data)?void 0:s.credits)||0,activeOrders:(null==(r=l.data)?void 0:r.length)||0,activeReservations:(null==(t=n.data)?void 0:t.length)||0,availableDAs:(null==(a=c.data)?void 0:a.length)||0})}catch(e){console.error("Erreur chargement statistiques:",e)}},M=async()=>{e&&await Promise.all([q(e.id),R(e.id)])};return D?(0,t.jsx)(y,{}):C?(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-red-600 mb-4",children:"Erreur"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:C}),(0,t.jsx)("button",{onClick:()=>window.location.reload(),className:"bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700",children:"R\xe9essayer"})]})}):e&&r?(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,t.jsx)(c,{user:e,userProfile:r}),(0,t.jsxs)("main",{className:"max-w-7xl mx-auto px-6 py-8",children:[(0,t.jsx)(o,{stats:n}),(0,t.jsx)(m,{tabs:N,activeTab:p,onTabChange:w}),(0,t.jsx)("div",{className:"mt-8",children:(()=>{if(!e||!r)return null;let s={user:e,userProfile:r,supabase:E,onRefresh:M};switch(p){case"overview":default:return(0,t.jsx)(x,{...s,stats:n});case"feedback":return(0,t.jsx)(u,{...s});case"referral":return(0,t.jsx)(h,{...s});case"promos":return(0,t.jsx)(g,{...s});case"library":return(0,t.jsx)(b,{...s});case"subscriptions":return(0,t.jsx)(v,{});case"invoices":return(0,t.jsx)(f,{})}})()})]})]}):(0,t.jsx)(y,{})}},8035:(e,s,r)=>{Promise.resolve().then(r.bind(r,3683))}},e=>{var s=s=>e(e.s=s);e.O(0,[874,63,302,441,684,358],()=>s(8035)),_N_E=e.O()}]);